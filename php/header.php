<?php
$servname="localhost";
$key_cryptage='la securite avant tout';//clé de cryptage
$pass=openssl_decrypt(base64_decode("QUpZdVg3QVh2NU5Va29ZdnhEeDNPQT09"),"AES-128-ECB",$key_cryptage);
$user=openssl_decrypt("5UfEC4F+32Kr6EtKpwtz8A==","AES-128-ECB",$key_cryptage);

$bdd= new PDO("mysql:host=$servname;dbname=boulangerie",$user,$pass); //connexion base de données
$bdd->setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION);

?>
<!-- fait -->
<header class="headfirst">
    <div class="uphead">
        <div class="logo">
            <a href="index.php" title="Accueil">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="150.000000pt" height="142.000000pt" viewBox="0 0 150.000000 142.000000" preserveAspectRatio="xMidYMid meet">
                    <g transform="translate(0.000000,142.000000) scale(0.100000,-0.100000)" fill="#fff" stroke="none">
                        <path d="M575 1403 c-97 -24 -227 -106 -313 -198 -109 -116 -188 -291 -162 -355 15 -36 21 -38 352 -139 253 -78 269 -81 296 -67 37 19 110 99 117 128 9 36 -168 598 -195 620 -21 17 -53 21 -95 11z" />
                        <path d="M789 1402 c-13 -6 -4 -44 66 -267 98 -316 91 -298 109 -288 8 4 75 87 150 183 144 186 153 205 116 252 -27 35 -145 95 -221 113 -65 15 -191 19 -220 7z" />
                        <path d="M1209 1013 c-46 -59 -90 -115 -96 -124 -12 -15 -2 -19 108 -39 136 -25 157 -22 184 31 16 29 16 35 0 75 -18 49 -92 164 -104 164 -5 0 -46 -48 -92 -107z" />
                        <path d="M95 664 c-18 -168 84 -414 173 -414 22 0 69 31 203 136 162 126 197 159 187 170 -3 2 -121 40 -264 83 -142 44 -266 82 -276 86 -14 5 -17 -4 -23 -61z" />
                        <path d="M502 302 l-123 -97 38 -33 c21 -18 66 -47 101 -63 72 -35 102 -31 136 14 20 27 20 28 2 140 -10 61 -21 117 -25 124 -4 7 -51 -24 -129 -85z" />
                    </g>
                </svg>
            </a>
        </div>
        <div class="site">
            <svg width="587" id="nomSite" height="64" viewBox="0 0 587 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M30.9884 31.152C32.8124 31.44 34.4684 32.184 35.9564 33.384C37.4924 34.584 38.6924 36.072 39.5564 37.848C40.4684 39.624 40.9244 41.52 40.9244 43.536C40.9244 46.08 40.2764 48.384 38.9804 50.448C37.6844 52.464 35.7884 54.072 33.2924 55.272C30.8444 56.424 27.9404 57 24.5804 57H5.86041V6.81599H23.8604C27.2684 6.81599 30.1724 7.39199 32.5724 8.54399C34.9724 9.64799 36.7724 11.16 37.9724 13.08C39.1724 15 39.7724 17.16 39.7724 19.56C39.7724 22.536 38.9564 25.008 37.3244 26.976C35.7404 28.896 33.6284 30.288 30.9884 31.152ZM12.4124 28.488H23.4284C26.5004 28.488 28.8764 27.768 30.5564 26.328C32.2364 24.888 33.0764 22.896 33.0764 20.352C33.0764 17.808 32.2364 15.816 30.5564 14.376C28.8764 12.936 26.4524 12.216 23.2844 12.216H12.4124V28.488ZM24.0044 51.6C27.2684 51.6 29.8124 50.832 31.6364 49.296C33.4604 47.76 34.3724 45.624 34.3724 42.888C34.3724 40.104 33.4124 37.92 31.4924 36.336C29.5724 34.704 27.0044 33.888 23.7884 33.888H12.4124V51.6H24.0044Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M76.4407 57L64.4887 36.48H56.5687V57H50.0167V6.81599H66.2167C70.0087 6.81599 73.2007 7.46399 75.7927 8.75999C78.4327 10.056 80.4007 11.808 81.6967 14.016C82.9927 16.224 83.6407 18.744 83.6407 21.576C83.6407 25.032 82.6327 28.08 80.6167 30.72C78.6487 33.36 75.6727 35.112 71.6887 35.976L84.2887 57H76.4407ZM56.5687 31.224H66.2167C69.7687 31.224 72.4327 30.36 74.2087 28.632C75.9847 26.856 76.8727 24.504 76.8727 21.576C76.8727 18.6 75.9847 16.296 74.2087 14.664C72.4807 13.032 69.8167 12.216 66.2167 12.216H56.5687V31.224Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M100.373 12.144V28.92H118.661V34.32H100.373V51.6H120.821V57H93.8214V6.74399H120.821V12.144H100.373Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M160.399 45.84H138.511L134.479 57H127.567L145.711 7.10399H153.271L171.343 57H164.431L160.399 45.84ZM158.527 40.512L149.455 15.168L140.383 40.512H158.527Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M206.467 57L185.803 34.104V57H179.251V6.81599H185.803V30.072L206.539 6.81599H214.819L192.067 31.944L215.035 57H206.467Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M228.905 6.81599V57H222.353V6.81599H228.905Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M279.527 57H272.975L246.623 17.04V57H240.071V6.74399H246.623L272.975 46.632V6.74399H279.527V57Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M328.712 21.36C327.32 18.432 325.304 16.176 322.664 14.592C320.024 12.96 316.952 12.144 313.448 12.144C309.944 12.144 306.776 12.96 303.944 14.592C301.16 16.176 298.952 18.48 297.32 21.504C295.736 24.48 294.944 27.936 294.944 31.872C294.944 35.808 295.736 39.264 297.32 42.24C298.952 45.216 301.16 47.52 303.944 49.152C306.776 50.736 309.944 51.528 313.448 51.528C318.344 51.528 322.376 50.064 325.544 47.136C328.712 44.208 330.56 40.248 331.088 35.256H311.072V29.928H338.072V34.968C337.688 39.096 336.392 42.888 334.184 46.344C331.976 49.752 329.072 52.464 325.472 54.48C321.872 56.448 317.864 57.432 313.448 57.432C308.792 57.432 304.544 56.352 300.704 54.192C296.864 51.984 293.816 48.936 291.56 45.048C289.352 41.16 288.248 36.768 288.248 31.872C288.248 26.976 289.352 22.584 291.56 18.696C293.816 14.76 296.864 11.712 300.704 9.55199C304.544 7.34399 308.792 6.23999 313.448 6.23999C318.776 6.23999 323.48 7.55999 327.56 10.2C331.688 12.84 334.688 16.56 336.56 21.36H328.712Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M391.059 31.152C392.883 31.44 394.539 32.184 396.027 33.384C397.563 34.584 398.763 36.072 399.627 37.848C400.539 39.624 400.995 41.52 400.995 43.536C400.995 46.08 400.347 48.384 399.051 50.448C397.755 52.464 395.859 54.072 393.363 55.272C390.915 56.424 388.011 57 384.651 57H365.931V6.81599H383.931C387.339 6.81599 390.243 7.39199 392.643 8.54399C395.043 9.64799 396.843 11.16 398.043 13.08C399.243 15 399.843 17.16 399.843 19.56C399.843 22.536 399.027 25.008 397.395 26.976C395.811 28.896 393.699 30.288 391.059 31.152ZM372.483 28.488H383.499C386.571 28.488 388.947 27.768 390.627 26.328C392.307 24.888 393.147 22.896 393.147 20.352C393.147 17.808 392.307 15.816 390.627 14.376C388.947 12.936 386.523 12.216 383.355 12.216H372.483V28.488ZM384.075 51.6C387.339 51.6 389.883 50.832 391.707 49.296C393.531 47.76 394.443 45.624 394.443 42.888C394.443 40.104 393.483 37.92 391.563 36.336C389.643 34.704 387.075 33.888 383.859 33.888H372.483V51.6H384.075Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M436.511 57L424.559 36.48H416.639V57H410.087V6.81599H426.287C430.079 6.81599 433.271 7.46399 435.863 8.75999C438.503 10.056 440.471 11.808 441.767 14.016C443.063 16.224 443.711 18.744 443.711 21.576C443.711 25.032 442.703 28.08 440.687 30.72C438.719 33.36 435.743 35.112 431.759 35.976L444.359 57H436.511ZM416.639 31.224H426.287C429.839 31.224 432.503 30.36 434.279 28.632C436.055 26.856 436.943 24.504 436.943 21.576C436.943 18.6 436.055 16.296 434.279 14.664C432.551 13.032 429.887 12.216 426.287 12.216H416.639V31.224Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M460.444 12.144V28.92H478.732V34.32H460.444V51.6H480.892V57H453.892V6.74399H480.892V12.144H460.444Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M520.47 45.84H498.582L494.55 57H487.638L505.782 7.10399H513.342L531.414 57H524.502L520.47 45.84ZM518.598 40.512L509.526 15.168L500.454 40.512H518.598Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <path d="M554.945 6.81599C560.417 6.81599 565.145 7.84799 569.129 9.91199C573.161 11.928 576.233 14.832 578.345 18.624C580.505 22.416 581.585 26.88 581.585 32.016C581.585 37.152 580.505 41.616 578.345 45.408C576.233 49.152 573.161 52.032 569.129 54.048C565.145 56.016 560.417 57 554.945 57H539.321V6.81599H554.945ZM554.945 51.6C561.425 51.6 566.369 49.896 569.777 46.488C573.185 43.032 574.889 38.208 574.889 32.016C574.889 25.776 573.161 20.904 569.705 17.4C566.297 13.896 561.377 12.144 554.945 12.144H545.873V51.6H554.945Z" stroke="white" stroke-width="10" mask="url(#path-1-outside-1_1_8)" />
                <mask id="path-1-outside-1_1_8" maskUnits="userSpaceOnUse" x="0.860413" y="0.23999" width="586" height="64" fill="black">
                    <rect fill="white" x="0.860413" y="0.23999" width="586" height="64" />
                    <path d="M30.9884 31.152C32.8124 31.44 34.4684 32.184 35.9564 33.384C37.4924 34.584 38.6924 36.072 39.5564 37.848C40.4684 39.624 40.9244 41.52 40.9244 43.536C40.9244 46.08 40.2764 48.384 38.9804 50.448C37.6844 52.464 35.7884 54.072 33.2924 55.272C30.8444 56.424 27.9404 57 24.5804 57H5.86041V6.81599H23.8604C27.2684 6.81599 30.1724 7.39199 32.5724 8.54399C34.9724 9.64799 36.7724 11.16 37.9724 13.08C39.1724 15 39.7724 17.16 39.7724 19.56C39.7724 22.536 38.9564 25.008 37.3244 26.976C35.7404 28.896 33.6284 30.288 30.9884 31.152ZM12.4124 28.488H23.4284C26.5004 28.488 28.8764 27.768 30.5564 26.328C32.2364 24.888 33.0764 22.896 33.0764 20.352C33.0764 17.808 32.2364 15.816 30.5564 14.376C28.8764 12.936 26.4524 12.216 23.2844 12.216H12.4124V28.488ZM24.0044 51.6C27.2684 51.6 29.8124 50.832 31.6364 49.296C33.4604 47.76 34.3724 45.624 34.3724 42.888C34.3724 40.104 33.4124 37.92 31.4924 36.336C29.5724 34.704 27.0044 33.888 23.7884 33.888H12.4124V51.6H24.0044Z" />
                    <path d="M76.4407 57L64.4887 36.48H56.5687V57H50.0167V6.81599H66.2167C70.0087 6.81599 73.2007 7.46399 75.7927 8.75999C78.4327 10.056 80.4007 11.808 81.6967 14.016C82.9927 16.224 83.6407 18.744 83.6407 21.576C83.6407 25.032 82.6327 28.08 80.6167 30.72C78.6487 33.36 75.6727 35.112 71.6887 35.976L84.2887 57H76.4407ZM56.5687 31.224H66.2167C69.7687 31.224 72.4327 30.36 74.2087 28.632C75.9847 26.856 76.8727 24.504 76.8727 21.576C76.8727 18.6 75.9847 16.296 74.2087 14.664C72.4807 13.032 69.8167 12.216 66.2167 12.216H56.5687V31.224Z" />
                    <path d="M100.373 12.144V28.92H118.661V34.32H100.373V51.6H120.821V57H93.8214V6.74399H120.821V12.144H100.373Z" />
                    <path d="M160.399 45.84H138.511L134.479 57H127.567L145.711 7.10399H153.271L171.343 57H164.431L160.399 45.84ZM158.527 40.512L149.455 15.168L140.383 40.512H158.527Z" />
                    <path d="M206.467 57L185.803 34.104V57H179.251V6.81599H185.803V30.072L206.539 6.81599H214.819L192.067 31.944L215.035 57H206.467Z" />
                    <path d="M228.905 6.81599V57H222.353V6.81599H228.905Z" />
                    <path d="M279.527 57H272.975L246.623 17.04V57H240.071V6.74399H246.623L272.975 46.632V6.74399H279.527V57Z" />
                    <path d="M328.712 21.36C327.32 18.432 325.304 16.176 322.664 14.592C320.024 12.96 316.952 12.144 313.448 12.144C309.944 12.144 306.776 12.96 303.944 14.592C301.16 16.176 298.952 18.48 297.32 21.504C295.736 24.48 294.944 27.936 294.944 31.872C294.944 35.808 295.736 39.264 297.32 42.24C298.952 45.216 301.16 47.52 303.944 49.152C306.776 50.736 309.944 51.528 313.448 51.528C318.344 51.528 322.376 50.064 325.544 47.136C328.712 44.208 330.56 40.248 331.088 35.256H311.072V29.928H338.072V34.968C337.688 39.096 336.392 42.888 334.184 46.344C331.976 49.752 329.072 52.464 325.472 54.48C321.872 56.448 317.864 57.432 313.448 57.432C308.792 57.432 304.544 56.352 300.704 54.192C296.864 51.984 293.816 48.936 291.56 45.048C289.352 41.16 288.248 36.768 288.248 31.872C288.248 26.976 289.352 22.584 291.56 18.696C293.816 14.76 296.864 11.712 300.704 9.55199C304.544 7.34399 308.792 6.23999 313.448 6.23999C318.776 6.23999 323.48 7.55999 327.56 10.2C331.688 12.84 334.688 16.56 336.56 21.36H328.712Z" />
                    <path d="M391.059 31.152C392.883 31.44 394.539 32.184 396.027 33.384C397.563 34.584 398.763 36.072 399.627 37.848C400.539 39.624 400.995 41.52 400.995 43.536C400.995 46.08 400.347 48.384 399.051 50.448C397.755 52.464 395.859 54.072 393.363 55.272C390.915 56.424 388.011 57 384.651 57H365.931V6.81599H383.931C387.339 6.81599 390.243 7.39199 392.643 8.54399C395.043 9.64799 396.843 11.16 398.043 13.08C399.243 15 399.843 17.16 399.843 19.56C399.843 22.536 399.027 25.008 397.395 26.976C395.811 28.896 393.699 30.288 391.059 31.152ZM372.483 28.488H383.499C386.571 28.488 388.947 27.768 390.627 26.328C392.307 24.888 393.147 22.896 393.147 20.352C393.147 17.808 392.307 15.816 390.627 14.376C388.947 12.936 386.523 12.216 383.355 12.216H372.483V28.488ZM384.075 51.6C387.339 51.6 389.883 50.832 391.707 49.296C393.531 47.76 394.443 45.624 394.443 42.888C394.443 40.104 393.483 37.92 391.563 36.336C389.643 34.704 387.075 33.888 383.859 33.888H372.483V51.6H384.075Z" />
                    <path d="M436.511 57L424.559 36.48H416.639V57H410.087V6.81599H426.287C430.079 6.81599 433.271 7.46399 435.863 8.75999C438.503 10.056 440.471 11.808 441.767 14.016C443.063 16.224 443.711 18.744 443.711 21.576C443.711 25.032 442.703 28.08 440.687 30.72C438.719 33.36 435.743 35.112 431.759 35.976L444.359 57H436.511ZM416.639 31.224H426.287C429.839 31.224 432.503 30.36 434.279 28.632C436.055 26.856 436.943 24.504 436.943 21.576C436.943 18.6 436.055 16.296 434.279 14.664C432.551 13.032 429.887 12.216 426.287 12.216H416.639V31.224Z" />
                    <path d="M460.444 12.144V28.92H478.732V34.32H460.444V51.6H480.892V57H453.892V6.74399H480.892V12.144H460.444Z" />
                    <path d="M520.47 45.84H498.582L494.55 57H487.638L505.782 7.10399H513.342L531.414 57H524.502L520.47 45.84ZM518.598 40.512L509.526 15.168L500.454 40.512H518.598Z" />
                    <path d="M554.945 6.81599C560.417 6.81599 565.145 7.84799 569.129 9.91199C573.161 11.928 576.233 14.832 578.345 18.624C580.505 22.416 581.585 26.88 581.585 32.016C581.585 37.152 580.505 41.616 578.345 45.408C576.233 49.152 573.161 52.032 569.129 54.048C565.145 56.016 560.417 57 554.945 57H539.321V6.81599H554.945ZM554.945 51.6C561.425 51.6 566.369 49.896 569.777 46.488C573.185 43.032 574.889 38.208 574.889 32.016C574.889 25.776 573.161 20.904 569.705 17.4C566.297 13.896 561.377 12.144 554.945 12.144H545.873V51.6H554.945Z" />
                </mask>
            </svg>
        </div>
        <div class="righthead">
            <div class="panier">
                <a href="panier.php"><i class="fa-solid fa-basket-shopping icone"></i> Shopping Cart
                    <?php
                    if (!empty($_SESSION['panier'])) {
                        foreach ($_SESSION['panier'] as $tab_min) {
                            $total_quantity = intval($total_quantity) + intval($tab_min['quantity']);
                            $prix_total = floatval($prix_total) + (floatval($tab_min['prix']) * intval($tab_min['quantity']));
                        }
                        echo ' : ' . $total_quantity . ' produits achetés - ' . $prix_total . ' euros';
                    }
                    ?></a>
            </div>
            <div class="connexion">
                <a href="connexion.php">
                    <i class="fa-solid fa-user icone"></i>
                    <?php if ($_SESSION['connecte'] == 1 || $_SESSION['connecte'] == 2) {
                        echo $_SESSION['utilisateur'];
                    } else {
                        echo 'Connexion';
                    }
                    ?></a>
            </div>
            <?php
            if ($_SESSION["connecte"] == 1 || $_SESSION['connecte'] == 2) {
                echo '<div class="deconnexion"><a href="php/logout.php"><i class="fa-solid fa-right-from-bracket"></i>Déconnexion</a></div>';
            }
            ?>
        </div>
    </div>
    <div class="parent_bottomhead">
        <nav class="bottomhead">
            <label for="menu-mobile" class="menu-mobile">Menu</label>
            <input type="checkbox" id="menu-mobile" role="button">
            <ul>
                <li class="menu_categorie"><a href="index.php">HOME PAGE</a></li>

                <?php
                //récupère les données 
                $recup_categorie = $bdd->prepare("SELECT link,cate,reference,icone from categorie;");
                $recup_categorie->execute();
                $categorie = $recup_categorie->fetchAll(PDO::FETCH_ASSOC);



                //affiche la barre de nav du haut
                for( $i=0;$i<$recup_categorie->rowCount();$i++){
                    if($categorie[$i]['link'] != '' && $categorie[$i]['cate']!= ''){
                        echo '<li class="menu_categorie"><a href="' . $categorie[$i]["link"] . '">' . $categorie[$i]["cate"] . '</a>';
                        echo '<ul class="submenu">';

                        $recup_produit = $bdd->prepare("SELECT code,nom,reference,stock from produit where categorie_id = {$categorie[$i]["reference"]} ;");
                        $recup_produit->execute();
                        $produit = $recup_produit->fetchAll(PDO::FETCH_ASSOC);

                        for($j=0;$j<$recup_produit->rowCount();$j++){
                            if( $produit[$j]['stock'] > 0){
                                echo '<li><a href="produit.php?produit=' . $categorie[$i]["reference"] . '&amp;code=' . $produit[$j]['code'] . '">' . $produit[$j]['nom'] . '</a></li>';
                            }
                        }
                        echo '</ul></li>';
                    }
                    else {
                        echo 'probleme with the sql database, please try again';
                        header('Location: http://localhost:8080/index.php');
                        exit();
                    }
                }
                ?>

                <li class="menu_categorie"><a href="contact.php">CONTACT</a></li>
            </ul>
        </nav>
    </div>
</header>
<div class="ensemble">
    <div class="main-menu">
        <ul>
            <section class="links">
                <li class="menu-item"><i class="fa fa-house"></i><a href="index.php">HOME PAGE</a></li>
                <?php
                //barre de nav sur le coté
                for( $i=0;$i<$recup_categorie->rowCount();$i++){
                    if($categorie[$i]['link'] != '' && $categorie[$i]['cate']!= ''){
                        echo '<li class="menu-item">' . $categorie[$i]["icone"] . '<a href="' . $categorie[$i]['link'] . '">' . $categorie[$i]['cate'] . '</a></li>';
                    }
                    else {
                        echo 'probleme with the sql database, please try again';
                        header('Location: http://localhost:8080/index.php');
                        exit();
                    }
                }
                ?>
                <li class="menu-item"><i class="fa fa-address-book "></i><a href="contact.php">CONTACT</a></li>
            </section>
        </ul>
    </div>
    <!-- penser a fermer la div-->